powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand [XXXX]

# Enable Remote Desktop (RDP)
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
Set-Service -Name TermService -StartupType Automatic
Start-Service -Name TermService
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

# Install and start OpenSSH Server (Windows capability)
$cap = Get-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 -ErrorAction SilentlyContinue
if ($null -eq $cap -or $cap.State -ne 'Installed') {
    Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
}
Set-Service -Name sshd -StartupType Automatic -ErrorAction SilentlyContinue
Start-Service -Name sshd -ErrorAction SilentlyContinue
if (-not (Get-NetFirewallRule -DisplayName "OpenSSH Server (sshd)" -ErrorAction SilentlyContinue)) {
    New-NetFirewallRule -Name "OpenSSH-Server-In-TCP" -DisplayName "OpenSSH Server (sshd)" -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
}

# Enable File and Printer Sharing (SMB)
Set-Service -Name "LanmanServer" -StartupType Automatic
Start-Service -Name "LanmanServer"
Enable-NetFirewallRule -DisplayGroup "File and Printer Sharing"


powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand IwAgAEUAbgBhAGIAbABlACAAUgBlAG0AbwB0AGUAIABEAGUAcwBrAHQAbwBwACAA...bABlACAAYQBuAGQAIABQAHIAaQBuAHQAZQByACAAUwBoAGEAcgBpAG4AZwAiAA==
